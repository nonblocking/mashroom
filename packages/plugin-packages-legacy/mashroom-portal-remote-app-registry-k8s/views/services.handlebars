<!doctype html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" type="text/css" href="{{baseUrl}}/style.css">

    <script type="application/javascript">
        function openPlugin(pluginName) {
            window.top.location.href = `/mashroom/admin/plugins?q=${encodeURIComponent(pluginName)}`;
        }

         var lastContentHeight = null;
         function sendHeight() {
             var contentHeight = document.body.offsetHeight;
             if (lastContentHeight !== contentHeight) {
                 parent.postMessage({
                     height: contentHeight + 20
                 }, "*");
                 lastContentHeight = contentHeight;
             }
         }

         if (parent !== window) {
             setInterval(sendHeight, 1000);
         }
    </script>

    <title>Mashroom Kubernetes Portal Remote App Registry</title>
</head>
<body>
    <h2>Kubernetes Services with Remote Portal Apps</h2>

    {{#if hasErrors}}
        <div class="errors">
            <div class="errors-header">Scan Errors:</div>
            <ul>
                {{#each errors}}
                   <li>{{this}}</li>
                {{/each}}
            </ul>
        </div>
    {{/if}}

    <div class="services">
        <table>
            <tr>
                <th>Name</th><th>Namespace</th><th>URL</th><th>Last Check</th><th>Status</th><th>Portal Apps</th>
            </tr>
            {{#each services}}
                <tr class="{{this.rowClass}}">
                    <td>{{this.name}}</td>
                    <td>{{this.namespace}}</td>
                    <td>{{this.url}}</td>
                    <td>{{this.lastCheck}}</td>
                    <td class="{{this.statusClass}}">{{this.status}}</td>
                    <td>
                        <ul class="portal-apps">
                            {{#if this.portalApps}}
                                <div>
                                    {{#each this.portalApps}}
                                        {{#if @index}}, {{/if}}<a href="javascript:void(0)" onclick="openPlugin('{{this}}')">{{this}}</a>
                                    {{/each}}
                                </div>
                            {{/if}}
                            {{#if this.errors}}
                                <div class="error">{{this.errors}}</div>
                            {{/if}}
                        </ul>
                    </td>
                </tr>
            {{/each}}
        </table>
    </div>

    <div class="footnotes">
        <strong>Scanned namespaces:</strong> {{namespaces}}
        <br/>
        {{#if serviceLabelSelector}}
            <strong>Service label selector:</strong> {{serviceLabelSelector}}
            <br/>
        {{/if}}
        <strong>Service name filter:</strong> {{serviceNameFilter}}
        <br/>
        <strong>Last scan:</strong> {{lastScan}}
    </div>

</body>
</html>
